<app-sidebar></app-sidebar>

<div class="page-wrapper">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h2>ุทูุจุงุช ุฑูุน ุงููุญุงุถุฑุงุช</h2>
      <div class="page-actions">
        <button
          class="refresh-btn"
          (click)="refreshData()"
          [disabled]="loading"
          title="ุชุญุฏูุซ ุงูุจูุงูุงุช">
          <span class="refresh-icon" [class.spinning]="loading">๐</span>
          ุชุญุฏูุซ
        </button>
      </div>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="success-message">
      <span class="icon">โ</span>
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message">
      <span class="icon">โ</span>
      {{ errorMessage }}
      <button class="retry-btn" (click)="refreshData()">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-message">
      <div class="spinner"></div>
      ุฌุงุฑ ุชุญููู ุทูุจุงุช ุงููุญุงุถุฑุงุช...
    </div>

    <!-- Main Content -->
    <div *ngIf="!loading" class="content-wrapper">
      <!-- Filters and Search -->
      <div class="filters-section">
        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="ุงูุจุญุซ ูู ุงูุทูุจุงุช (ุงูุนููุงูุ ุงูููุดุฆุ ุงููุงุฏุฉ...)"
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()">
          <span class="search-icon">๐</span>
        </div>

        <div class="filters-row">
          <div class="filter-group">
            <label>ุชุตููุฉ ุญุณุจ ุงูุชุงุฑูุฎ:</label>
            <select
              class="filter-select"
              [(ngModel)]="selectedFilter"
              (change)="onFilterChange()">
              <option
                *ngFor="let option of filterOptions"
                [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label>ุชุฑุชูุจ ุญุณุจ:</label>
            <div class="sort-container">
              <select
                class="filter-select"
                [(ngModel)]="sortBy"
                (change)="onSortChange()">
                <option
                  *ngFor="let option of sortOptions"
                  [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
              <button
                class="sort-order-btn"
                (click)="toggleSortOrder()"
                [title]="sortOrder === 'asc' ? 'ุชุฑุชูุจ ุชุตุงุนุฏู' : 'ุชุฑุชูุจ ุชูุงุฒูู'">
                {{ sortOrder === 'asc' ? 'โ' : 'โ' }}
              </button>
            </div>
          </div>

          <div class="results-count">
            <span>{{ filteredRequests.length }} ุทูุจ</span>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div *ngIf="filteredRequests.length === 0 && !loading" class="no-requests">
        <div class="no-requests-icon">๐</div>
        <div class="no-requests-content">
          <h3>ูุง ุชูุฌุฏ ุทูุจุงุช ูุญุงุถุฑุงุช</h3>
          <p *ngIf="searchTerm || selectedFilter !== 'all'">
            ูู ูุชู ุงูุนุซูุฑ ุนูู ุทูุจุงุช ุชุทุงุจู ูุนุงููุฑ ุงูุจุญุซ ุงููุญุฏุฏุฉ
          </p>
          <p *ngIf="!searchTerm && selectedFilter === 'all'">
            ูุง ุชูุฌุฏ ุทูุจุงุช ูุญุงุถุฑุงุช ูู ุงูุชุธุงุฑ ุงูููุงููุฉ ุญุงููุงู
          </p>
        </div>
      </div>

      <!-- Requests List -->
      <div *ngIf="filteredRequests.length > 0" class="requests-container">
        <div
          *ngFor="let request of filteredRequests; trackBy: trackByRequestId"
          class="request-card"
          [class.expanded]="request.expanded">

          <!-- Request Header -->
          <div class="request-header" (click)="toggleRequestDetails(request.id)">
            <div class="request-main-info">
              <div class="creator-avatar">
                {{ getInitials(request.creatorName) }}
              </div>
              <div class="request-title-section">
                <h3 class="request-title">{{ request.title }}</h3>
                <div class="request-meta">
                  <span class="creator-name">{{ request.creatorName }}</span>
                  <span class="separator">โข</span>
                  <span class="subject">{{ request.subject }}</span>
                  <span class="separator">โข</span>
                  <span class="date">{{ formatDate(request.createdAt) }}</span>
                </div>
              </div>
            </div>

            <div class="request-actions-quick">
              <div class="expand-icon" [class.rotated]="request.expanded">
                โ
              </div>
            </div>
          </div>

          <!-- Request Details (Expanded) -->
          <div *ngIf="request.expanded" class="request-details">
            <div class="details-grid">
              <div class="detail-item">
                <label>ุงููุตู:</label>
                <p>{{ request.description }}</p>
              </div>

              <div class="detail-item">
                <label>ุงููุณุชูู ุงูุฃูุงุฏููู:</label>
                <span class="badge academic-level">{{ request.academicLevel }}</span>
              </div>

              <div class="detail-item">
                <label>ุงููุตู ุงูุฏุฑุงุณู:</label>
                <span class="badge semester">{{ request.semester }}</span>
              </div>

              <div class="detail-item">
                <label>ุงูุจูุฏ:</label>
                <span class="badge country">{{ request.country }}</span>
              </div>

              <div class="detail-item">
                <label>ุงุณู ุงูููู:</label>
                <div class="file-actions">
                  <button
                    class="file-name-btn"
                    (click)="openPdfFile(request.id, request.fileName)"
                    [disabled]="isPdfLoading(request.id, 'view')"
                    title="ูุชุญ ุงูููู ูู ุชุจููุจ ุฌุฏูุฏ">
                    <span *ngIf="!isPdfLoading(request.id, 'view')" class="file-icon">๐</span>
                    <span *ngIf="isPdfLoading(request.id, 'view')" class="spinner-small"></span>
                    {{ request.fileName }}
                    <span *ngIf="!isPdfLoading(request.id, 'view')" class="open-icon">๐</span>
                  </button>
                  <button
                    class="download-btn"
                    (click)="downloadPdfFile(request.id, request.fileName)"
                    [disabled]="isPdfLoading(request.id, 'download')"
                    title="ุชุญููู ุงูููู">
                    <span *ngIf="!isPdfLoading(request.id, 'download')" class="download-icon">โฌ๏ธ</span>
                    <span *ngIf="isPdfLoading(request.id, 'download')" class="spinner-small"></span>
                  </button>
                </div>
              </div>

              <div class="detail-item">
                <label>ุฑูุนู:</label>
                <span class="uploader">{{ request.uploadedBy }}</span>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button
                class="approve-btn"
                (click)="showConfirmation('approve', request.id, request.title)"
                [disabled]="isProcessing(request.id)"
                title="ุงูููุงููุฉ ุนูู ุงูุทูุจ">
                <span *ngIf="!isProcessing(request.id)" class="icon">โ</span>
                <span *ngIf="isProcessing(request.id)" class="spinner-small"></span>
                ููุงููุฉ
              </button>

              <button
                class="reject-btn"
                (click)="showConfirmation('reject', request.id, request.title)"
                [disabled]="isProcessing(request.id)"
                title="ุฑูุถ ุงูุทูุจ">
                <span *ngIf="!isProcessing(request.id)" class="icon">โ</span>
                <span *ngIf="isProcessing(request.id)" class="spinner-small"></span>
                ุฑูุถ
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirmation Dialog -->
    <div *ngIf="showConfirmDialog" class="confirm-dialog">
      <div class="dialog-content">
        <h3>ุชุฃููุฏ ุงูุนูููุฉ</h3>
        <p>
          ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู
          <strong>{{ confirmAction === 'approve' ? 'ุงูููุงููุฉ ุนูู' : 'ุฑูุถ' }}</strong>
          ุทูุจ ุงููุญุงุถุฑุฉ:
        </p>
        <p class="request-title-confirm">{{ selectedRequestTitle }}</p>

        <div class="dialog-actions">
          <button
            class="confirm-btn"
            (click)="confirmActionSubmit()"
            [class.approve]="confirmAction === 'approve'"
            [class.reject]="confirmAction === 'reject'">
            {{ confirmAction === 'approve' ? 'ููุงููุฉ' : 'ุฑูุถ' }}
          </button>
          <button class="cancel-btn" (click)="cancelConfirmation()">
            ุฅูุบุงุก
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
