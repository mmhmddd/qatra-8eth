<app-sidebar></app-sidebar>
<main>
  <div class="join-requests-container">
    <!-- Header Section -->
    <div class="page-header">
      <h2>ุฌููุน ุทูุจุงุช ุงูุงูุถูุงู</h2>
      <div class="page-actions">
        <button
          class="export-btn"
          (click)="exportToExcel()"
          [disabled]="isLoading || filteredRequests.length === 0"
          title="ุชุตุฏูุฑ ุฅูู Excel">
          <span class="export-icon">๐</span>
          ุชุตุฏูุฑ ุฅูู Excel
        </button>
      </div>
    </div>

    <div class="filter-container">
      <label for="statusFilter">ุชุตููุฉ ุญุณุจ ุงูุญุงูุฉ: </label>
      <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="filterRequests()">
        <option value="">ุงููู</option>
        <option value="Pending">ูุนูู</option>
        <option value="Approved">ููุงูู ุนููู</option>
        <option value="Rejected">ูุฑููุถ</option>
      </select>
    </div>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th *ngFor="let header of headers">{{ header.label }}</th>
            <th>ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of filteredRequests">
            <td *ngFor="let header of headers">
              <span *ngIf="header.key === 'status'" [ngClass]="getStatusClass(request.status)">
                {{ request.status | statusTranslate }}
              </span>
              <span *ngIf="header.key === 'email'" style="text-decoration: none">
                <a [href]="'mailto:' + request.email" class="text-primary" style="text-decoration: none">
                  {{ request.email || 'ุบูุฑ ูุชููุฑ' }}
                </a>
              </span>
              <span *ngIf="header.key !== 'status' && header.key !== 'email'">
                {{ request[header.key] || 'ุบูุฑ ูุชููุฑ' }}
              </span>
            </td>
            <td>
              <button
                class="btn btn-success"
                (click)="confirmApproveRequest(request.id)"
                [disabled]="request.status !== 'Pending' || isLoading || !request.id"
                title="ุงูููุงููุฉ ุนูู ุงูุทูุจ">
                <i class="fas fa-check"></i> ููุงููุฉ
              </button>
              <button
                class="btn btn-danger"
                (click)="confirmRejectRequest(request.id)"
                [disabled]="request.status !== 'Pending' || isLoading || !request.id"
                title="ุฑูุถ ุงูุทูุจ">
                <i class="fas fa-times"></i> ุฑูุถ
              </button>
              <button
                *ngIf="request.status === 'Rejected'"
                class="btn btn-danger-outline"
                (click)="confirmDeleteRequest(request.id)"
                [disabled]="isLoading || !request.id"
                title="ุญุฐู ุงูุทูุจ ุงููุฑููุถ ููุงุฆูุงู">
                <i class="fas fa-trash"></i> ุญุฐู
              </button>
            </td>
          </tr>
          <tr *ngIf="filteredRequests.length === 0">
            <td [attr.colspan]="headers.length + 1" class="text-center">ูุง ุชูุฌุฏ ุทูุจุงุช ุงูุถูุงู</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="loading-overlay" *ngIf="isLoading">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>ุฌุงุฑู ุงูุชุญููู...</p>
      </div>
    </div>
    <div *ngIf="toastMessage" class="toast" [ngClass]="{'toast-success': toastMessage.type === 'success', 'toast-error': toastMessage.type === 'error'}">
      {{ toastMessage.message }}
    </div>
  </div>
</main>
